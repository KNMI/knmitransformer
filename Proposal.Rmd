---
title: "Proposal for knmitransformer package"
author: "Christiana Photiadou and Martin Roth"
date: "September 5, 2016"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


The KNMI climate change scenarios have gained a great deal of reputation not only in the Netherlands but also abroad. 
Since their first edition in 2006 a new version was required to translate the findings of the IPCC report (2013) to the Netherlands. 
For the delivery of the KNMI14 scenarios a necessary update of the code resulted -together with moving staff- in having multiple versions of the transformation code. 
Today, there is no unified version and a responsible team to support it. 
Furthermore, we are moving into a user-friendly oriented climate services where we should be able to provide to the potential user an open source package of the transformation code. 

With this project we propose to develop an open source R-package of the KNMI scenario transformation with unified functionality.
The basic version of the proposed package will be validated such that it can be used to reproduce the KNMI14 (revised ‘15) scenarios (except for wind, humidity and fog).
The unified functionality of the package together with the automated regression testing will allow us to update and maintain efficiently future versions.
The R-package (library) will be distributed through the KNMI github account, where potential users, both inside and outside KNMI, will be able to use the package for individual use and projects.
For the web application, a Fortran wrap will be used to call the R package.
The output format (timeseries, dates, station id, etc) of the package will be decided within the team, following feedback from the expert users within KNMI.
At this stage no visualization of the results will be discussed, as this package focus on the transformation of the data.
A detailed documentation with a flowchart of the functionality of the package will be available together with the package itself. 
Finally, the benefits of the developed R-package will be, hopefully, demonstrated in the upcoming calculations for the future KNMI scenarios. 

The following people are invited to participate:

- Christiana Photiadou (expert user & development, project coordination)
- Martin Roth (development, project coordination)
- Geert Jan van Oldenborgh (expert user & development)
- Jules Beersma (expert user & development)
- Janette Bessembinder (communication)
- Rudmer Jilderda (expert user & development)


#### A work package description follows with detailed steps and milestones:

1.  Set up repository
    - Set up the base version (Time: 15 days[^1])  
    This is constructed in the first phase with the goal to recalculate the KNMI14 (version ‘15) scenarios. 
        * Collection of data (ready under version control): All data necessary for calculation of the scenarios (temperature, precipitation, global radiation…) are gathered. 
        * reference data 1981-2010: 102 stations for precipitation, temperature and rest?
        * deltas for all scenarios and time horizons. The deltas are separated from data and remain the same in this project. Update of deltas should not interfere with the functionality of the package.
        * First transformed of data and proceed to validation using KNMI14(‘15) scenarios
    - Manual regression test (Time: 8 days)  
    Here a regression test is performed to guarantee that the developed basic version  produces the same results as KNMI14(‘15). 
        * code and reference data should be the same as the transformed data
        * deltas should be the same
        * indices = scenarios

2. Switch to package structure and use automatic regression tests (Time: 13 days)
    - Internal structure for the deltas 
    - test De Bilt: for all variables, all scenarios
    - Calculation of the indices for the above selection. Corresponding version of index functions will be documented.
    - Profvis: profiling performance increase, multiple stations/grids 

##### FIRST MILESTONE
This basic version of the package can be used for the reproduction of the KNMI14 scenarios.

3. Communication: Fix appearance to user and output format (Time: 20 days)  
Contribution from Geert Jan, Rudmer, Janette, Jules etc
    - agree on one general function be used or a function per variable (temp, precip, etc)?
    - Wrapping function in fortran
    - User testing by Rudmer and Janette. The potential user should be in position to retrieve own results.
    - Fix output and input format (tidy data) 
    - Include metadata
    - All users have to agree on the functionality of the package
    - Internal changes of the packages functionality should not affect user 

4. Outreach web application (Time: 15 days)
    - shiny app 
    - Fortran call for climate explorer


##### SECOND MILESTONE
Use of the same version locally and online. Feedback from the users and potential improvements on the functionality are documented. 


5. Extend basis version   
Issues for an extended version will be address in this phase if necessary. List to be adapted after recommendations by the rest of the team
    - scientific method (A sounding board for the future directions should be established.)
    - longer time series (Rudmer?)
    - interpolating time range e.g. 2075 (Geert Jan?)

[^1]:
Time calculated for an average R user